---
title: "Arbeit mit Tabellen"
output:
  learnr::tutorial:
    language: de
    css: css/boxes.css
    fig_caption: yes
    df_print: default
runtime: shiny_prerendered
bibliography: ref.json
link-citations: TRUE
description: Was sind Data Frames? Das Indizieren mit $-Operator wird geübt. 
resource_files:
- css/boxes.css
editor_options:
  markdown:
    canonical: true
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(nycflights13)
knitr::opts_chunk$set(echo = TRUE)
```

## Inhalt {data-progressive="TRUE"}

In diesem Tutorial geht es um die Objektklasse, mit welcher du den Großteil der Zeit arbeiten wirst - Data Frames. Ein *Data Frame* ist jene Struktur, mit welcher **Tabellen** in R repräsentiert werden können.

Wenn du mit Tabellen in R arbeitest - und das wird oft sein - wird es sich meist um *Data Frames* - (oder einer speziellen Unterform davon, den *Tibbles*) handeln.

Dass du den Umgang mit Tabellen in R lernst, ist essentiell, da die meisten Daten auf dieser Welt irgendwie in Tabellen dargestellt werden.

## Lernziele

Im laufe des Tutorials wirst du...

<input type="checkbox" unchecked> verstehen wie Daten in Tabellen gelistet sind </input> <input type="checkbox" unchecked> verstehen warum Data Frames hilfreich sind </input> <input type="checkbox" unchecked> das Erstellen von Data Frames erlernen</input> <input type="checkbox" unchecked> das Zugreifen auf Variablen in Data Frames erlernen </input> <input type="checkbox" unchecked> das hinzufügen und löschen von Variablen in Data Frames erlernen </input>

::: blau-nb
Übrigens: Wir verwenden hier für die Eindeutschung "der" Data Frame, die innerliche Begründung lautet: *Frame* = Rahmen, "der" Rahmen :)
:::

## Data Frames

Im Tutorial "Vektoren" hast du bereits gelernt, dass Vektoren Variablen darstellen und mehrere Werte enthalten können. Im folgenden lernst du, wie du mehrere Vektoren in einer Tabelle (einem Data Frame) zusammenbringen kannst.

Einmal vorweg ein Beispiel für dich, wie ein Data Frame erstellt wird:

Schaue dir die Vektoren `alter` und `tier` im Codeblock an: Sie enthalten jeweils drei Elemente.

Führe den Code aus, um daraus einen Data Frame zu erstellen und anzuzeigen.

```{r dataframe, exercise = TRUE, exercise.caption = "Beispiel: Data Frame erstellen"}
alter <- c(14, 7, 1)
tier <- c("Hund", "Katze", "Maus")

df <- data.frame(alter, tier)
df
```

In der ersten Spalte siehst die Variable `alter` und in der zweiten Spalte die Variable `tier`. Die Werte werden wie bei einem einzelnen Vector untereinander angezeigt. Die Zeile sagt dir nun jedoch das Alter für das entsprechende Tier - ist also 1 Beobachtungsobjekt.

::: infobox
Neue Funktion: `data.frame()` Erstellt aus einzelnen *gleichlangen* Vektoren eine Tabelle.
:::

::: gelb
**Disclaimer**

In der Praxis wirst du zur Dateneingabe ein grafisches Programm wie Excel verwenden, und die fertige Tabelle dann für die Verwendung mit R importieren. Das wirst du im nächsten Tutorial "Datenimport" lernen.

Wenn im Folgenden immer wieder kleine Data Frames aus Vektoren erstellt werden, dient das nur dazu, Beispiele zu konstruieren um den Umgang zu erlernen, aber nicht weil das die übliche Methode ist, wie Daten in R eingegeben werden.
:::

### Prinzip

::: blau-nb
Die Idee eines Data Frames ist es, einen Haufen Vektoren gleicher Länge zu nehmen und damit eine Tabelle zu bauen. Dabei ist **jede Spalte ein Vektor**. Anders ausgedrückt: jede Spalte ist eine Variable.
:::

Das ist eine wichtige Grundstruktur, die du dir merken solltest, denn es bedeutet, dass für die Spalten einer Tabelle die gleichen Mechanismen greifen wie bei Vektoren. Das kannst du dir für den späteren Abschnitt zur Indizierung in Data Frames im Hinterkopf behalten.

Einen sehr simplen Data Frame mit den Variablen `X`und `Y`, die jeweils drei Werte enthalten, kannst du dir demnach so vorstellen:

![](images/data_frame.png){width="30%"}

source: [Base R cheat sheet by Mhairi McNeil](https://iqss.github.io/dss-workshops/R/Rintro/base-r-cheat-sheet.pdf)

</br>

::: blau-nb
Dieses Bild ist Teil des super nützlichen `cheat sheets` für Base R (also die Programmiersprache R). Ein Blick darauf lohnt sich, wenn die Sprache für dich komplett neu ist oder du mal längere Zeit nicht mit R gearbeitet hast. Dort sind alle wichtigen Funktionen zusammengefasst und deren Funktionen teilweise grafisch dargestellt. `Cheat Sheets` gibt es für nahezu jede Programmiersprache.
:::

### Erstellung eines Data Frames

Du kennst jetzt die Funktion `data.frame()`, um aus deinen Variablen einen Data Frame zu erstellen. Aber wie genau benutzt du sie? Das wirst du gleich verstehen.

#### Namensgebung: Neu = Alt

Wenn du aus bestehenden Variablen einen Data Frame erstellst, solltest du zuerst dafür sorgen, dass die Variablen aussagekräftige, aber kurze Namen in deinem Data Frame erhalten. Du brauchst sie später, um auf deine Daten zuzugreifen.

Eine in R übliche Konvention für Namensgebungs-Situationen ist die Reihenfolge `NEW = OLD`.

Bei der Verwendung von `data.frame()` kommen wir in eine solche Situation, weil wir während der Erstellung Spaltennamen vergeben können. Betrachte dazu das folgende Beispiel, wo wir eine Tabelle mit Daten über eine WG erstellen.

Schon beim Assignment, was ja auch eine Namensgebungs-Situation ist, gilt: Links steht immer der neue Name, rechts immer der alte Name oder Inhalt.

Achte auf die Argumente von `data.frame()`: Dort gilt das gleiche Schema. Die "neuen" Spaltennamen stehen jeweils auf der linken Seite des Gleichheitszeichens, der "alte" Name des bereits vorhandenen Vektors auf der rechten. Die Argumente (in diesem Fall die Vektoren) sind für eine gute Lesbarkeit auf eigene Zeilen aufgeteilt.

```{r new_is_old, exercise = TRUE, exercise.caption = "Neu ist Alt"}
# Mitbewohnis in einer WG

# Schema: neu <- alt
x <- c("Amadou", "Mira", "Luisa", "Alex")
y <- c(2000, 2001, 1990, 1995)
z <- 5.23 

# 2. Data Frame erstellen und dabei Spalten benennen. Gleiches Schema:

wg <- data.frame(
  name = x, 
  jahrgang = y, 
  grundpreis = z) 
wg
```

Das ist gut zu wissen, denn dieses Schema gilt als Konvention für die meisten Bennennungssituationen in R.

### Lerntest

Hast du im Tutorial "Vektoren" gut aufgepasst?

Eigentlich hast du eben gelernt, alle Vektoren müssen gleich lang sein um einen Data Frame zu erstellen. Warum funktioniert es oben trotzdem, obwohl Vektor `z` nur Länge 1 hat und nicht ebenfalls 4?

```{r recyc-quiz, echo = FALSE}
learnr::question_radio(
  "Das liegt ...",
  answer("am Konzept der Vektorisierung, was bedeutet, dass eine Funktion die einen Vektor als Input bekommt auch einen Vektor der gleichen Länge als Output gibt",
         message = "Vektorisierung ist nicht die Ursache hier, aber die Beschreibung ist korrekt."),
  answer("an R's Eigenart, dass kürzere Vektoren ohne Warnung „recycelt“ werden, wenn die Länge des längeren ein Vielfaches des kürzeren ist", 
         correct = TRUE,
         message = "Das Konzept des Recycling ist hier die Ursache. Sollte ein Vektor aber kein Vielfaches des anderen sein, gibt es bei der Erstellung von Data Frames einen Fehler."),
  answer("daran, dass es ein Fehler in der Software ist, der seit den 90ern nicht behoben wurde",
         message = "Manche Leute sehen das so, weil es still und leise passiert,
         aber es ist so gewolltes Verhalten von den Entwickler*innen."),
  answer("daran, dass das Dezimaltrennzeichen der Punkt ist",
         message = "Das stimmt für sich genommen, ist aber nicht die Ursache"),
  answer("daran, dass Vektoren immer nur einen einzigen Datentyp enthalten dürfen",
         message = "Das stimmt für sich genommen, ist aber nicht die Ursache"),
  allow_retry = TRUE
)
```

## Indizierung von Data Frames

Der Data Frame WG ist nun erstellt. Um damit auch arbeiten zu können, brauchst du dein Wissen aus dem Tutorial "Indizierung".

Es gibt 2 wesentliche Arten auf die Daten in dem Data Frame zuzugreifen: Das Indizieren auf Grundlage einer Liste (List-Subsetting) oder auf Grundlage einer Matrix (Matrix-Subsetting).

"Was heißt das jetzt?" - Nun ja, ein Data Frame in R ist sowohl eine spezielle Art einer Liste als auch einer Matrix. Daher kannst du sowohl `List Subsetting` als auch `Matrix Subsetting` verwenden.

Fangen wir mit dem Prinzip von Matrizen an.

### Die Matrix

Die Matrix ist dir vielleicht noch ein Begriff aus der Filmwelt und hoffentlich auch aus dem Matheunterricht. Simple gesprochen ist sie eine zweidimensionale Datenstruktur mit Spalten und Zeilen. Sie kann Zahlen oder Text enthalten. Aber keine Angst, wir werden hier keine Matrizen multiplizieren oder Gleichungen nach X aufgelösen.

![](images/matrix.png){width="80%"}

### Matrix erstellen

Eine Matrix in R ist eine flexible Datenstruktur, die es dir ermöglicht, verschiedene Datentypen zu speichern. Sie wird durch den Befehl `matrix()` erstellt. Von der Dokumentation (Hilfe) kannst du erfahren, dass dieser Befehl folgende Argumente ermöglicht: `matrix(data = NA, nrow = 1, ncol = 1, byrow = FALSE,dimnames = NULL)`

```{r matrix, exercise = TRUE, exercise.caption = "Beispiel: Erstellen einer Matrix"}
# unsere bekannten WG-Daten
x <- c("Amadou", "Mira", "Luisa", "Alex")
y <- c(2000, 2001, 1990, 1995)
z <- c(5.23, 5.23, 5.23, 5.23) 

# 2. Matrix erstellen und dabei Nummer an Spalten durch die Länge des Vektors(x) vorgeben:
wg_matrix <- matrix(c(x,y,z), nrow = length(x)) 
wg_matrix
```

Zur Veranschaulichung bleiben wir bei dem WG Beispiel. Als Matrix dargestellt bekommen wir den obrigen Output. Vielleicht kommen dir die eckigen Klammern bekannt vor, was meinst du können wir damit machen?

```{r matrix-quiz, echo = FALSE}
learnr::question_checkbox(
  "Die eckigen Klammern ...",
  answer("dienen zur Anzeige der Spalten und Zeilen",
         message = "Richtig! Die eckigen Klammern repräsentieren die Spalten und Zeilen der Matrixelemente.", 
         correct = TRUE,
         ),
  answer("ein Fehler in der Syntax",
         message = "Die eckigen Klammern sind keine Syntaxfehler. Mit einem Syntaxfehler ist der Code nicht mehr ausführbar und du bekommst eine Fehlernachricht"),
  answer("können für die Indizierung genutzt werden",
         message = "Wie auch schon bei Vektoren werden eckige Klammern für die Indizierung genutzt",
         correct = TRUE),
  answer("Platzhalter für fehlende Daten",
         message = "Leider nein. Der Platzhalter für fehlende Daten is NA"),
  allow_retry = TRUE
)
```

Dann probiere es doch gleich mal aus!

::: Aufgabe
Schau dir die Matrix oben nochmal an und versuche auf den Jahrgang von Luisa zuzugreifen.
:::

```{r Luisa, exercise = TRUE, exercise.setup = "matrix"}
# Auf die Matrix zugreifen:

```

```{r Luisa-solution}
# erinnere dich, dass du mit den eckigen Klammern auf die Elemente zugreifen kannst
wg_matrix[x,y] # erstetze x und y durch die entsprechenden Zeilen und Spalten 
```

Da die Matrix 2 Dimensionen hat, hat auch die eckige Klammer zwei Positionen, die du für das Zugreifen verwenden kannst. Dabei bezieht sich der erste Wert auf die Zeile und der zweite auf die Spalte.

::: blau-nb
Merke auf eine Matrix greifst du wie folgt zu: `matrix[Zeile, Spalte]`
:::

Da es visuell leichter zu verstehen ist, auch hier ein kurzer Ausschnitt aus dem `Cheat Sheet`.

![](images/matrix_subsetting.png){width = "20%"} source: [Base R cheat sheet by Mhairi McNeil](https://iqss.github.io/dss-workshops/R/Rintro/base-r-cheat-sheet.pdf)

### Listen

\<\<<Erklärung anfügen>\>\>

### Listen erstellen

Eine Liste ist eine flexible Datenstruktur, die es dir ermöglicht, verschiedene Datentypen zu speichern. Hier ist ein Beispiel:

\<\<<Beispiel anfügen>\>\>

\<\<<Aufgabe anfügen>\>\>

### Data Frames

Eine besondere Art von Liste ist der Data Frame. Ein Data Frame organisiert Daten in tabellarischer Form.

\<\<<Erklärung anfügen>\>\>

\<\<<Beispiel anfügen>\>\>

\<\<<Aufgabe anfügen>\>\>

#### Data Frame Subsetting

\<\<<Erklärung anfügen>\>\>

##### Matrix Subsetting

##### List Subsetting

##### Data Frame verändern

Manchmal möchtest du Spalten oder Zeilen hinzufügen oder entfernen.

\<\<<Erklärung anfügen>\>\>

\<\<<Beispiel anfügen>\>\>

::: aufgabe
Füge dem Data Frame wg_df eine neue Spalte namens miete hinzu, indem du den grundpreis mit der quadratmeter multiplizierst. Entferne die Spalte balkon aus dem Data Frame wg_df.
:::

## Credit

Dieses Tutorial wurde (größtenteils) von Marie Klosterkamp sowie in Teilen von Lukas Bruelheide geschrieben. Bei der Erstellung (u.a. der Beispiele, Aufgaben, Bilder und Zusammenfassung) wurde teilweise von ChatGPT gebrauch gemacht.
