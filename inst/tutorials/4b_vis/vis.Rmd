---
title: "Visualisierung"
output:
  learnr::tutorial:
    language: de
    css: css/boxes.css
    fig_caption: no
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
bibliography: ref.json
link-citations: TRUE
description: Schnelle Diagramme erstellen, schöne Diagramme erstellen. Die Grammar of Graphs wird kurz erklärt, das Prinzip wonach ggplot2 aufgebaut ist. Die Erstellung verschiedener Diagrammarten wird geübt. Aesthetic Mappings, Geoms, Facets. 
resource_files:
- css/boxes.css
tutorial:
      id: ggplot
      version: 1
---

```{r setup, include=FALSE}
library(learnr)
library(ggplot2)
library(kableExtra)
library(tibble)
library(rtutorials)
knitr::opts_chunk$set(echo = FALSE)
```

## Inhalt

Jetzt kommt wirklich einer der allercoolsten Teile des ganzen Kurses. R ist einfach
unfassbar mächtig, was das Visualisieren von Daten angeht, viel ausgefeilter und vielfältiger, als
Excel und SPSS es je erreichen können. Unser Ziel ist euch ein paar schnelle Kochrezepte für die wichtigsten
Visualisierungsaufgaben mitzugeben, und die Neugier auf mehr zu wecken, in dem wir eine kleine Einführung in das Visualisierungspaket `ggplot2` geben.

### Lernziele

<input type="checkbox" unchecked> Punktdiagramm (*scatterplot*) </input>

<input type="checkbox" unchecked> Balkendiagramm (*barplot*) </input>

<input type="checkbox" unchecked> Histogramm (*histogram*) </input>

<input type="checkbox" unchecked> Liniendiagramm (*linegraph*) </input>

<input type="checkbox" unchecked> Boxplot </input>

<input type="checkbox" unchecked> Schnelle Grafikfunktionen zum Überblick </input>

<input type="checkbox" unchecked> Grafiken mit `ggplot2` nach dem Baukasten der *Grammar of Graphs* erstellen </inpu>

<input type="checkbox" unchecked> colorblind-friendly sein </input>

### benötigtes Paket

Der erste Schritt für dieses Tutorial ist, das Paket `ggplot2` in die aktive Sitzung zu laden. Tu das mittels `library()`!


```{r lib, exercise = TRUE, exercise.cap = "ggplot2 laden"}
library()
```

```{r lib-solution}
library(ggplot2)
```

### Die fünf essentiellen Diagrammtypen

```{r echo=FALSE}
de <- c("Punktdiagramm","Liniendiagramm","Histogramm","Boxplot","Balkendiagramm")
en <- c("scatterplot","linegraph", "histogram", "boxplot", "barplot")
vars <- c("2 stetige Variablen", "1 stetige und 1 zeitlich geordnete Variable",
          "stetige Variablen", "1 stetige Variable", "1 kategoriale Variable")
tibble(` `= c("1.", "2.", "3.", "4.", "5."), de, en, `geeignet für` = vars) |>
  kbl() |>
  kable_styling()
```

```{r fiveplots, fig.height=8, out.width="100%"}
par(mfrow = c(3, 2),
    bty = "n")
plot(heated[ ,c("maxtemp", "edvisits")],
     main = "1.",
     axes = F,
     ylab = NA,
     xlab = NA)
plot(heated$enddate[heated$enddate > as.Date("2022-03-24")], 
     heated$maxtemp[heated$enddate > as.Date("2022-03-24")],
     type = "l",
     main = "2.",
     axes = F,
     ylab = NA,
     xlab = NA)
hist(heated$maxtemp,
     main = "3.",
     axes = F,
     ylab = NA,
     xlab = NA)
boxplot(heated$maxtemp ~ factor(lubridate::month(heated$enddate)),
        main = "4.",
        axes = F,
        ylab = NA,
        xlab = NA)
barplot({einkaufen$Verkehrsmittel |> table()}[1:5],
        main = "5.",
        axes = F,
        ylab = NA,
        xlab = NA,
        names.arg = NA)
# reset par
par(mfrow = c(1, 1),
    bty = "o")
```


## Grammar of Graphs

Einiges im Folgenden orientiert sich an einem tollen, frei verfügbaren Online-Lehrbuch namens [*Modern Dive*](https://www.moderndive.com) [@ismay2022]. Ab hier wird das Kapitel zu Visualisierungen in Teilen übersetzt und paraphrasiert.

<hr>

### Geschichte

Leland Wilkinson ist der Gründer des Grammar of Graphs-Ansatzes. Im Grunde ist das eine Theorie darüber, mit welchen Regeln und Bausteinen statistische Grafiken erstellt werden können [@wilkinson2005].

`ggplot2` ist die Umsetzung dieses theoretischen Baukastens, und das `gg` steht für *Grammar of Graphs*. Es wurde von Hadley Wickham geschrieben und ist ein relativ altes Paket im R-Ökosystem [@wickham2009]. Es stammt aus einer Zeit, als es selbst den `magrittr` Pipe-Operator `%>%` noch nicht gab. Deswegen verwendet `ggplot2` seinen eigenen Pipe-Operator, ein `+`. Dazu aber später mehr.

### Baukasten

Gehen wir sofort zur Sache:

> „Eine statistische Grafik ist: ein *aesthetic mapping* von Variablen auf die visuellen Eigenschaften geometrischer Objekte."

So sieht `ggplot2`-Code aus, um

## Barrierefreiheit

Ein nicht zu vernachlässigender Anteil der Bevölkerung kann bestimmte Farben nicht unterscheiden. Deswegen wurden von schlauen Menschen Farbpaletten entworfen, die keine ambivalenten Farben wie rot und grün enthalten, und auch ganz ohne Farbwahrnehmung nur über Helligkeit und Dunkelheit der Farben in schwarz weiß funktionieren würden. 

Eine der verbreitetesten ist `viridis`.

### Viridis

```{r viridis-demo, message=FALSE, warning=FALSE}
library(ggplot2)
library(hexbin)
library(viridis)

dat <- data.frame(x = rnorm(10000), y = rnorm(10000))

p <- ggplot(dat, aes(x = x, y = y)) +
  geom_hex() + coord_fixed() +
  scale_fill_gradientn(colours = viridis(256, option = "D")) +
  theme_bw()

p
```

Die obenstehende Grafik ist ein gutes Beispiel dafür, wie hell-dunkel Kontraste verwendet werden können. So ist das Ganze in schwarz-weiß immer noch lesbar, was insbesondere für Menschen mit eingeschränkter Farbwahrnehmung klasse ist, denn alles was schwarz weiß gut lesbar ist, ist immer auch colorblind-friendly. 

## Credit

### Literaturverzeichnis
